<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="./index.css" />
  <link rel="icon" type="image/x-icon" href="./favicon.ico">
  <script src="js/echarts.min.js"></script>

  <!-- <link href="leaflet/leaflet.css" rel="stylesheet">
  <script src="leaflet/leaflet.js"></script>
  
  <script src="leaflet/heatmap.min.js"></script>
  <script src="leaflet/leaflet-heatmap.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.5.0/css/ol.css"
    type="text/css">
  <script src="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.5.0/build/ol.js"></script> -->

  <title>全国大气污染可视分析系统</title>
</head>

<body>
  <div class="head">
    <div class="title">
      全国大气污染可视分析系统
    </div>
    <!-- <button>
      切换对比视图
    </button> -->
  </div>

  <div class="grid">

    <div class="cell">
      <div class="box control" id="box1">
        <div id="date_title">
          <input type="date" id="date_select" min="2013-01-01" max="2018-12-31" value="2013-01-01">
          </el-date-picker>
        </div>
        <div class="container">
          <div class="column first-column">
            <div class="item">
              <div class="text" id="aqi">AQI 202</div>
            </div>
            <div class="item">
              <svg xmlns="http://www.w3.org/2000/svg" width="1.5em" height="1.5em" viewBox="0 0 256 256">
                <path fill="currentColor"
                  d="M24 104a12 12 0 0 1 0-24h96a12 12 0 0 0 0-24a15.07 15.07 0 0 0-10.26 4.45a12 12 0 0 1-17-16.9A39.34 39.34 0 0 1 120 32a36 36 0 0 1 0 72Zm184-36a39.34 39.34 0 0 0-27.3 11.55a12 12 0 0 0 17 16.9A15.07 15.07 0 0 1 208 92a12 12 0 0 1 0 24H32a12 12 0 0 0 0 24h176a36 36 0 0 0 0-72m-56 84H40a12 12 0 0 0 0 24h112a12 12 0 0 1 0 24a15.11 15.11 0 0 1-10.27-4.45a12 12 0 1 0-17 16.9A39.34 39.34 0 0 0 152 224a36 36 0 0 0 0-72" />
              </svg>
              <div class="text" id="wind"> 西北风
              </div>

            </div>
            <div class="item">
              <svg xmlns="http://www.w3.org/2000/svg" width="1.5em" height="1.5em" viewBox="0 0 32 32">
                <path fill="currentColor" d="M30 18h-6a2.002 2.002 0 0 1-2-2V6a2.002 2.002 0 0 1 2-2h6v2h-6v10h6Z" />
                <circle cx="18" cy="4" r="2" fill="currentColor" />
                <path fill="currentColor" d="M10 20.184V12H8v8.184a3 3 0 1 0 2 0" />
                <path fill="currentColor"
                  d="M9 30a6.993 6.993 0 0 1-5-11.89V7a5 5 0 0 1 10 0v11.11A6.993 6.993 0 0 1 9 30M9 4a3.003 3.003 0 0 0-3 3v11.983l-.332.299a5 5 0 1 0 6.664 0L12 18.983V7a3.003 3.003 0 0 0-3-3" />
              </svg>
              <div class="text" id="temperature">
                -0.23℃
              </div>
            </div>
            <div class="item">
              <svg xmlns="http://www.w3.org/2000/svg" width="1.5em" height="1.5em" viewBox="0 0 24 24">
                <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2">
                  <path
                    d="M7 16.3c2.2 0 4-1.83 4-4.05c0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05" />
                  <path
                    d="M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97" />
                </g>
              </svg>
              <div class="text" id="humidity">37.06%</div>
            </div>

            <div class="item">
              <svg xmlns="http://www.w3.org/2000/svg" width="1.5em" height="1.5em" viewBox="0 0 24 24">
                <path fill="currentColor"
                  d="M15.393 6.792c-.043-.021-.591.41-.634.389l-2.229 4.554a1.958 1.958 0 0 0-.53-.107a2.024 2.024 0 0 0-2.022 2.022a1.986 1.986 0 0 0 .9 1.64l-.888 1.941l.683.314l.9-1.959a1.886 1.886 0 0 0 .425.086a2.025 2.025 0 0 0 2.023-2.022a1.986 1.986 0 0 0-.819-1.581l2.23-4.558c-.04-.02.004-.698-.039-.719M12 15.034a1.384 1.384 0 1 1 1.384-1.384A1.385 1.385 0 0 1 12 15.034m6.957-9.062l-.841.742a8.823 8.823 0 0 1 .072 12.768a12.973 12.973 0 0 0-6.31-1.309a13.036 13.036 0 0 0-6.126 1.249a8.823 8.823 0 0 1 .2-12.769l-.841-.742a9.965 9.965 0 0 0 .431 14.852l.016.017a13.741 13.741 0 0 1 6.32-1.492a13.712 13.712 0 0 1 6.468 1.571a9.978 9.978 0 0 0 .605-14.887ZM12 4.258a8.84 8.84 0 0 1 5.715 2.092l.841-.742a9.949 9.949 0 0 0-13.044-.062l.841.742A8.842 8.842 0 0 1 12 4.258" />
              </svg>
              <div class="text" id="pressure">87kPa</div>
            </div>
            <div class="item">
              <div class="text" id="change" title="">
                <svg xmlns="http://www.w3.org/2000/svg" width="3em" height="3em" viewBox="0 0 24 24">
                  <path fill="currentColor"
                    d="M18 14a4 4 0 1 1-3.995 4.2L14 18l.005-.2A4 4 0 0 1 18 14M16.707 2.293a1 1 0 0 1 .083 1.32l-.083.094L15.414 5H19a3 3 0 0 1 2.995 2.824L22 8v3a1 1 0 0 1-1.993.117L20 11V8a1 1 0 0 0-.883-.993L19 7h-3.585l1.292 1.293a1 1 0 0 1-1.32 1.497l-.094-.083l-3-3a.98.98 0 0 1-.28-.872l.036-.146l.04-.104c.058-.126.14-.24.245-.334l2.959-2.958a1 1 0 0 1 1.414 0M3 12a1 1 0 0 1 .993.883L4 13v3a1 1 0 0 0 .883.993L5 17h3.585l-1.292-1.293a1 1 0 0 1-.083-1.32l.083-.094a1 1 0 0 1 1.32-.083l.094.083l3 3a.98.98 0 0 1 .28.872l-.036.146l-.04.104a1.02 1.02 0 0 1-.245.334l-2.959 2.958a1 1 0 0 1-1.497-1.32l.083-.094L8.584 19H5a3 3 0 0 1-2.995-2.824L2 16v-3a1 1 0 0 1 1-1M6 2a4 4 0 1 1-3.995 4.2L2 6l.005-.2A4 4 0 0 1 6 2" />
                </svg>
              </div>
            </div>
          </div>
          <div class="column second-column">
            <div class="item">
              <p id="province">北京</p>
            </div>
            <div class="item">
              </svg>
              <div class="item-div" id="donut1">

              </div>
              <div class="item-div" id="donut2">

              </div>
              <div class="item-div" id="donut3">

              </div>
              <div class="item-div" id="donut4">

              </div>
              <div class="item-div" id="donut5">

              </div>
              <div class="item-div" id="donut6">

              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="cell" id="cell1">
      <div class="subtitle">
        污染指标与气象数据地图
      </div>
      <div class="box" id="box2"></div>
    </div>

    <div class="cell" id="cell2" style="float: left">
      <div class="subtitle">
        污染指标线圈图
      </div>
      <div id="heatmap" style="width: 100%; float: left;"></div>

    </div>
    <div class="cell" id="cell4">
      <div class="subtitle" id="AQI_title">
        全年AQI指标概览
      </div>
      <div id="heatChart" style="width: 100%;height: 100%;"></div>

    </div>
    <div class="cell" id="cell5">
      <div class="subtitle">
        污染物指标雷达图
      </div>
      <div id="radarChart" style="width: 100%;height: 100%;"></div>
    </div>
    <div class="cell" id="cell3">
      <div class="subtitle">
        污染物指标堆叠图
      </div>
      <div id="stackChart" style="width: 100%;height: 100%;"></div>
    </div>

  </div>
</body>
<script>

  document.addEventListener("DOMContentLoaded", () => {
    let dragged = null;

    document.querySelectorAll(".box").forEach((box) => {
      box.draggable = true;

      box.addEventListener("dragstart", (event) => {
        dragged = event.target; // 被拖动的元素
        setTimeout(() => (event.target.style.opacity = "0.5"), 0);
      });

      box.addEventListener("dragend", (event) => {
        event.target.style.opacity = ""; // 重置透明度
      });
    });

    document.querySelectorAll(".cell").forEach((cell) => {
      cell.addEventListener("dragover", (event) => {
        event.preventDefault(); // 允许放置
      });

      cell.addEventListener("drop", (event) => {
        event.preventDefault();
        if (dragged) {
          const targetCell = event.target.closest(".cell");
          // 开始移动逻辑
          moveBoxToNextAvailableCell(targetCell);
          // 将被拖动的 box 放到目标单元格（已经被腾空）
          targetCell.appendChild(dragged);
        }
      });
    });

    function moveBoxToNextAvailableCell(cell) {
      let currentCell = cell;
      let nextCell =
        currentCell.nextElementSibling ||
        currentCell.parentNode.firstElementChild; // 循环逻辑：如果是最后一个单元格，则跳到第一个
      if (currentCell.contains(dragged)) {
        // 如果当前单元格是被拖动的 box 的起始点，无需移动
        return;
      }
      if (currentCell.querySelector(".box")) {
        // 如果当前单元格已有 box，则先将这个 box 移动到下一个可用的单元格
        moveBoxToNextAvailableCell(nextCell);
      }
      // 将当前单元格的 box 移动到下一个单元格
      let boxToMove = currentCell.querySelector(".box");
      if (boxToMove) {
        nextCell.appendChild(boxToMove);
      }
    }

    // 修改这里以添加右键拖曳调整大小的功能
    const cells = document.querySelectorAll(".cell");
    cells.forEach((cell) => {
      cell.addEventListener("mousedown", (e) => {
        cell.addEventListener("contextmenu", (e) => {
          e.preventDefault(); // 阻止默认的右键菜单
        });
        if (e.button === 2) { // 检查是否是右键点击
          e.preventDefault(); // 阻止默认的右键菜单
          let startX = e.clientX;
          let startY = e.clientY;
          let startWidth = parseInt(document.defaultView.getComputedStyle(cell).width, 10);
          let startHeight = parseInt(document.defaultView.getComputedStyle(cell).height, 10);

          function doDrag(e) {
            cell.style.width = startWidth + e.clientX - startX + "px";
            cell.style.height = startHeight + e.clientY - startY + "px";
          }

          function stopDrag() {
            document.documentElement.removeEventListener("mousemove", doDrag, false);
            document.documentElement.removeEventListener("mouseup", stopDrag, false);
          }

          document.documentElement.addEventListener("mousemove", doDrag, false);
          document.documentElement.addEventListener("mouseup", stopDrag, false);
        }
      });
    });
  });

</script>
<script src="js/global.js"></script>
<script src="js/data.js"></script>
<script src="js/chinamap.js"></script>
<script src="js/windmap.js"></script>
<script src="js/heatmap.js"></script>
<script src="js/heatChart.js"></script>
<script src="js/control.js"></script>
<script src="js/stackDiagram.js"></script>
<script src="js/radar.js"></script>
</html>